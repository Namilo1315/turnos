<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Panel â€” EstÃ©tica Bellezza</title>
<meta name="theme-color" content="#ec4899">
<link rel="icon" href="data:,"><!-- evita 404 de favicon -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.12.4/dist/sweetalert2.min.css" rel="stylesheet">
<link href="assets/style.css" rel="stylesheet"><!-- opcional -->
<style>
  :root{
    --rose:#ec4899; --rose-2:#db2777; --ink:#0b1220; --muted:#6b7280;
    --paper:#ffffff; --soft:#fff1f2; --chip:#ffe4e6; --ring:#fbcfe8; --border:#ffe4e6;
  }
  *{box-sizing:border-box}
  body{font-family:"Inter",system-ui,-apple-system,Segoe UI,Roboto; color:var(--ink); background:linear-gradient(180deg,#fff 0%, #fff7fb 100%);}

  /* NAV */
  .navbar{background:rgba(255,255,255,.9); backdrop-filter:blur(8px); border-bottom:1px solid var(--border);}
  .navbar-brand{font-weight:900}
  .btn-primary{background:var(--rose); border-color:var(--rose)}
  .btn-primary:hover{background:var(--rose-2); border-color:var(--rose-2)}
  .btn-outline-secondary{border-color:#e5e7eb}
  .btn-outline-secondary:hover{background:#f9fafb}

  /* CARDS */
  .card{border:1px solid var(--border); border-radius:1rem; background:var(--paper); box-shadow:0 18px 40px rgba(236,72,153,.06);}
  .card h5,.card h6{font-weight:900}

  /* KPI */
  .kpi-box{
    border:1px solid var(--border); border-radius:1rem; padding:1rem;
    background:linear-gradient(135deg,#fff1f2 0%, #fce7f3 100%);
    box-shadow:0 14px 30px rgba(236,72,153,.08);
  }
  .kpi-box .big{font-size:clamp(28px,4vw,40px); font-weight:900; line-height:1.1}
  .text-muted{color:var(--muted)!important}

  /* TABS */
  .nav-tabs{border-bottom:1px solid var(--border)}
  .nav-tabs .nav-link{font-weight:700; color:#6b7280}
  .nav-tabs .nav-link.active{
    color:#9d174d; border-color:var(--border) var(--border) #fff; background:#fff;
  }

  /* FORMS */
  .form-label{font-weight:600}
  input.form-control, select.form-select, .input-group .form-control{
    border-radius:.75rem; border-color:#fda4af;
  }
  input.form-control:focus, select.form-select:focus{
    box-shadow:0 0 0 .25rem var(--ring); border-color:#f472b6;
  }

  /* TABLE */
  .table thead th{font-weight:800; border-bottom:2px solid #ffe4e6}
  .table-hover tbody tr:hover{background:#fff7fb}
  .badge-soft{background:#fff1f2; border:1px solid #fecdd3; color:#9d174d; font-weight:700; border-radius:.6rem; padding:.2rem .5rem}

  /* CHARTS */
  .chart-wrap{position:relative; width:100%; min-height:280px}

  /* QR box */
  #qr canvas, #qr img{max-width:100%}

  /* Utilities */
  .shadow-soft{box-shadow:0 10px 24px rgba(17,24,39,.06)}
</style>
</head>
<body>

<!-- NAV -->
<nav class="navbar navbar-expand-lg sticky-top">
  <div class="container py-2">
    <a class="navbar-brand" href="index.html">EstÃ©tica Bellezza</a>
    <div class="ms-auto">
      <button id="logoutBtn" class="btn btn-outline-secondary btn-sm">Salir</button>
    </div>
  </div>
</nav>

<main class="container py-4">

  <!-- LOGIN -->
  <div id="loginBox" class="row justify-content-center">
    <div class="col-md-5">
      <div class="card p-3 p-md-4">
        <div class="card-body">
          <h4 class="fw-bold mb-2">Ingresar al panel</h4>
          <p class="small text-muted mb-3">Demo: PIN <span class="badge-soft">1234</span></p>
          <div class="input-group">
            <span class="input-group-text">ðŸ”’</span>
            <input id="pin" type="password" class="form-control" placeholder="PIN de acceso" autocomplete="current-password">
          </div>
          <button id="inBtn" class="btn btn-primary w-100 mt-3">Entrar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- APP -->
  <div id="app" class="d-none">
    <!-- KPIs -->
    <div class="row g-3 mb-3">
      <div class="col-12 col-md-4">
        <div class="kpi-box">
          <div class="small text-muted">Ganancia estimada</div>
          <div id="kpiRevenue" class="big">â€”</div>
        </div>
      </div>
      <div class="col-6 col-md-4">
        <div class="kpi-box">
          <div class="small text-muted">Turnos (Ãºltimos 7 dÃ­as)</div>
          <div id="kpiBookings" class="big">â€”</div>
        </div>
      </div>
      <div class="col-6 col-md-4">
        <div class="kpi-box">
          <div class="small text-muted">Cancelaciones</div>
          <div id="kpiCancel" class="big">â€”</div>
        </div>
      </div>
    </div>

    <!-- TABS -->
    <ul class="nav nav-tabs mb-3">
      <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-agenda" type="button">Agenda</button></li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-dashboard" type="button">Dashboard</button></li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-config" type="button">Config</button></li>
    </ul>

    <div class="tab-content">

      <!-- AGENDA -->
      <div class="tab-pane fade show active" id="tab-agenda">
        <div class="row g-3">
          <!-- NUEVO TURNO -->
          <div class="col-lg-4">
            <div class="card p-3 h-100">
              <h5 class="fw-bold mb-3">Nuevo turno</h5>

              <div class="mb-2">
                <label class="form-label">Servicio</label>
                <select id="a_svc" class="form-select"></select>
              </div>

              <div class="row g-2">
                <div class="col-6">
                  <label class="form-label">Fecha</label>
                  <input id="a_date" type="date" class="form-control">
                </div>
                <div class="col-6">
                  <label class="form-label">Hora</label>
                  <input id="a_time" type="time" class="form-control" step="900">
                </div>
              </div>

              <div class="row g-2 mt-1">
                <div class="col-7">
                  <input id="a_name" type="text" class="form-control" placeholder="Cliente">
                </div>
                <div class="col-5">
                  <input id="a_phone" type="tel" class="form-control" placeholder="WhatsApp">
                </div>
              </div>

              <input id="a_notes" class="form-control mt-2" placeholder="Notas (opcional)">
              <button id="a_add" class="btn btn-primary w-100 mt-3">Guardar</button>
            </div>
          </div>

          <!-- LISTA TURNOS -->
          <div class="col-lg-8">
            <div class="card p-3">
              <div class="d-flex flex-wrap justify-content-between align-items-center gap-2">
                <h5 class="fw-bold mb-0">PrÃ³ximos turnos</h5>
                <div class="d-flex flex-wrap gap-2">
                  <input id="filter_date" type="date" class="form-control form-control-sm">
                  <button id="clear_filter" class="btn btn-outline-secondary btn-sm">Limpiar</button>
                  <button id="exportCsv" class="btn btn-outline-secondary btn-sm">Exportar CSV</button>
                </div>
              </div>

              <div class="table-responsive mt-3">
                <table class="table table-hover align-middle">
                  <thead>
                    <tr>
                      <th>Fecha</th><th>Hora</th><th>Servicio</th><th>Cliente</th><th>WhatsApp</th><th>Estado</th><th></th>
                    </tr>
                  </thead>
                  <tbody id="agendaTable"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- DASHBOARD -->
      <div class="tab-pane fade" id="tab-dashboard">
        <div class="row g-3">
          <div class="col-lg-6">
            <div class="card p-3 h-100">
              <h6 class="fw-bold">Turnos por dÃ­a (lÃ­nea)</h6>
              <div class="chart-wrap"><canvas id="chartDays"></canvas></div>
            </div>
          </div>
          <div class="col-lg-6">
            <div class="card p-3 h-100">
              <h6 class="fw-bold">Turnos por servicio</h6>
              <div class="chart-wrap"><canvas id="chartServices"></canvas></div>
            </div>
          </div>
        </div>
      </div>

      <!-- CONFIG -->
      <div class="tab-pane fade" id="tab-config">
        <div class="row g-3">
          <!-- HORARIO -->
          <div class="col-lg-6">
            <div class="card p-3 h-100">
              <h5 class="fw-bold">Horario & Slots</h5>
              <div class="row g-2">
                <div class="col-6">
                  <label class="form-label">Apertura</label>
                  <input id="c_open" class="form-control" value="09:00">
                </div>
                <div class="col-6">
                  <label class="form-label">Cierre</label>
                  <input id="c_close" class="form-control" value="18:00">
                </div>
                <div class="col-6">
                  <label class="form-label">DuraciÃ³n (min)</label>
                  <input id="c_slot" type="number" class="form-control" value="30">
                </div>
                <div class="col-6">
                  <label class="form-label">WhatsApp negocio</label>
                  <input id="c_wa" class="form-control" value="549261333444">
                </div>
                <div class="col-12">
                  <label class="form-label">Alias/CBU para pagos (opcional)</label>
                  <input id="c_pay" class="form-control" placeholder="alias.mercadopago" value="">
                </div>
              </div>
              <button id="c_save" class="btn btn-primary w-100 mt-3">Guardar</button>
            </div>
          </div>

          <!-- SERVICIOS -->
          <div class="col-lg-6">
            <div class="card p-3 h-100">
              <div class="d-flex justify-content-between align-items-center">
                <h5 class="fw-bold mb-0">Servicios</h5>
                <button id="svc_add" class="btn btn-outline-secondary btn-sm">Agregar</button>
              </div>
              <div id="svc_list" class="mt-2"></div>
            </div>
          </div>
        </div>

        <div class="row g-3 mt-1">
          <!-- LINK PÃšBLICO -->
          <div class="col-lg-6">
            <div class="card p-3 h-100">
              <h6 class="fw-bold">Link pÃºblico</h6>
              <div class="input-group mb-2">
                <input id="publicLink" class="form-control" value="" readonly>
                <button id="copyLink" class="btn btn-outline-secondary">Copiar</button>
              </div>
              <div id="qr" class="mt-2"></div>
            </div>
          </div>

          <!-- BACKUP -->
          <div class="col-lg-6">
            <div class="card p-3 h-100">
              <h6 class="fw-bold">Backup</h6>
              <div class="d-flex flex-column flex-sm-row gap-2">
                <button id="backupBtn" class="btn btn-outline-secondary">Descargar JSON</button>
                <input id="restoreFile" type="file" accept="application/json" class="form-control">
              </div>
              <p class="small text-muted mt-2 mb-0">ExportÃ¡ e importÃ¡ todos tus datos.</p>
            </div>
          </div>
        </div>

      </div><!-- /tab-config -->
    </div><!-- /tab-content -->
  </div><!-- /app -->
</main>

<!-- LIBS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.12.4/dist/sweetalert2.all.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>

<!-- ===== Firebase (MÃ“DULO) ===== -->
<script type="module">
  import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";

  // Tu config
  const firebaseConfig = {
    apiKey: "AIzaSyBTOlML4dMiryC6x7s7HAWvhkrT_j-U4D4",
    authDomain: "turnero-432d4.firebaseapp.com",
    projectId: "turnero-432d4",
    storageBucket: "turnero-432d4.firebasestorage.app",
    messagingSenderId: "259318366599",
    appId: "1:259318366599:web:1e56a25b022942b1095322"
  };

  // Evita doble inicializaciÃ³n si otro mÃ³dulo ya lo hizo
  const app = getApps().length ? getApps()[0] : initializeApp(firebaseConfig);

  // (Opcional) Exponer para scripts no-mÃ³dulo (no deberÃ­a hacer falta, pero ayuda a migrar)
  window.__FIREBASE_APP__ = app;
</script>




<!-- UX mÃ­nima -->
<script>
  document.addEventListener('DOMContentLoaded', ()=>{
    const pin = document.getElementById('pin');
    if(pin) pin.focus({preventScroll:true});
  });
</script>
<!-- LIBS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.12.4/dist/sweetalert2.all.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>

<script type="module" src="js/db.js"></script>
<script defer src="js/admin.js"></script>

</body>
</html>


